# Malware and Exploit Signatures
# Detects known malware, exploits, and malicious file hashes

signatures:
  # Known Malware Families
  - id: SIG-MAL-001
    name: WannaCry Ransomware
    severity: critical
    category: malware
    description: Detects WannaCry ransomware indicators
    patterns:
      - regex: "(?i)wannacry|wanna\\s+cry|wcry"
      - regex: "(?i)@wanadecryptor@\\.exe"
    fields:
      - raw
      - message
      - normalized.file_name
    hashes:
      - value: "ed01ebfbc9eb5bbea545af4d01bf5f1071661840480439c6e5babe8e080e41aa"
        type: sha256
        description: WannaCry ransomware sample
      - value: "db349b97c37d22f5ea1d1841e3c89eb4"
        type: md5
        description: WannaCry ransomware sample
  
  - id: SIG-MAL-002
    name: Emotet Malware
    severity: critical
    category: malware
    description: Detects Emotet malware indicators
    patterns:
      - regex: "(?i)emotet"
      - regex: "(?i)heodo"
    fields:
      - raw
      - message
    hashes:
      - value: "4a5b8f8f9c8e7d6a5b4c3d2e1f0a9b8c7d6e5f4a3b2c1d0e9f8a7b6c5d4e3f2a"
        type: sha256
        description: Emotet malware sample
  
  - id: SIG-MAL-003
    name: Cobalt Strike Beacon
    severity: critical
    category: malware
    description: Detects Cobalt Strike beacon activity
    patterns:
      - regex: "(?i)cobalt\\s+strike"
      - regex: "(?i)/beacon\\.dll"
      - regex: "(?i)cobaltstrike"
    fields:
      - raw
      - message
      - normalized.process_name
  
  - id: SIG-MAL-004
    name: Mimikatz Credential Dumper
    severity: critical
    category: malware
    description: Detects Mimikatz credential dumping tool
    patterns:
      - regex: "(?i)mimikatz"
      - regex: "(?i)sekurlsa::logonpasswords"
      - regex: "(?i)lsadump::sam"
    fields:
      - raw
      - message
      - normalized.command
      - normalized.process_name
  
  # Web Shells
  - id: SIG-MAL-005
    name: Web Shell - PHP
    severity: critical
    category: malware
    description: Detects PHP web shell indicators
    patterns:
      - regex: "(?i)(c99|r57|b374k|wso|shell)\\.php"
      - regex: "(?i)eval\\s*\\(\\s*base64_decode"
      - regex: "(?i)system\\s*\\(\\s*\\$_(GET|POST|REQUEST)"
    fields:
      - raw
      - message
      - normalized.file_name
  
  - id: SIG-MAL-006
    name: Web Shell - ASP/ASPX
    severity: critical
    category: malware
    description: Detects ASP/ASPX web shell indicators
    patterns:
      - regex: "(?i)(china\\s+chopper|aspxspy)"
      - regex: "(?i)eval\\s*\\(\\s*request"
    fields:
      - raw
      - message
      - normalized.file_name
  
  - id: SIG-MAL-007
    name: Web Shell - JSP
    severity: critical
    category: malware
    description: Detects JSP web shell indicators
    patterns:
      - regex: "(?i)jspspy"
      - regex: "(?i)runtime\\.getruntime\\(\\)\\.exec"
    fields:
      - raw
      - message
      - normalized.file_name
  
  # Cryptominers
  - id: SIG-MAL-008
    name: Cryptocurrency Miner
    severity: high
    category: malware
    description: Detects cryptocurrency mining activity
    patterns:
      - regex: "(?i)(xmrig|cpuminer|ccminer|ethminer)"
      - regex: "(?i)stratum\\+tcp://"
      - regex: "(?i)mining\\s+pool"
    fields:
      - raw
      - message
      - normalized.process_name
      - normalized.command
  
  # Rootkits
  - id: SIG-MAL-009
    name: Linux Rootkit
    severity: critical
    category: malware
    description: Detects Linux rootkit indicators
    patterns:
      - regex: "(?i)(diamorphine|reptile|suterusu)"
      - regex: "(?i)/dev/shm/.*\\.so"
      - regex: "(?i)ld_preload.*malicious"
    fields:
      - raw
      - message
      - normalized.file_path
  
  # Backdoors
  - id: SIG-MAL-010
    name: SSH Backdoor
    severity: critical
    category: malware
    description: Detects SSH backdoor installation
    patterns:
      - regex: "(?i)authorized_keys.*suspicious"
      - regex: "(?i)\\.ssh/.*backdoor"
    fields:
      - raw
      - message
      - normalized.file_path
  
  # Exploit Kits
  - id: SIG-MAL-011
    name: Metasploit Framework
    severity: high
    category: exploit
    description: Detects Metasploit framework usage
    patterns:
      - regex: "(?i)metasploit|meterpreter"
      - regex: "(?i)msfvenom|msfconsole"
    fields:
      - raw
      - message
      - normalized.process_name
  
  - id: SIG-MAL-012
    name: Empire Framework
    severity: high
    category: exploit
    description: Detects PowerShell Empire framework
    patterns:
      - regex: "(?i)powershell\\s+empire"
      - regex: "(?i)invoke-empire"
    fields:
      - raw
      - message
      - normalized.command
  
  # Fileless Malware
  - id: SIG-MAL-013
    name: Fileless Malware - PowerShell
    severity: critical
    category: malware
    description: Detects fileless malware using PowerShell
    patterns:
      - regex: "(?i)powershell.*-enc(odedcommand)?"
      - regex: "(?i)invoke-expression.*downloadstring"
      - regex: "(?i)iex.*new-object.*net\\.webclient"
    fields:
      - raw
      - message
      - normalized.command
  
  - id: SIG-MAL-014
    name: Fileless Malware - WMI
    severity: critical
    category: malware
    description: Detects fileless malware using WMI
    patterns:
      - regex: "(?i)wmic.*process\\s+call\\s+create.*powershell"
      - regex: "(?i)wmi.*commandlinetemplate"
    fields:
      - raw
      - message
      - normalized.command
  
  # Ransomware
  - id: SIG-MAL-015
    name: Ransomware - File Encryption
    severity: critical
    category: malware
    description: Detects ransomware file encryption activity
    patterns:
      - regex: "(?i)\\.(encrypted|locked|crypto|crypt)"
      - regex: "(?i)ransom(ware)?.*note"
      - regex: "(?i)decrypt.*bitcoin"
    fields:
      - raw
      - message
      - normalized.file_name
  
  # Trojans
  - id: SIG-MAL-016
    name: Remote Access Trojan (RAT)
    severity: critical
    category: malware
    description: Detects RAT activity
    patterns:
      - regex: "(?i)(darkcomet|njrat|nanocore|quasar)"
      - regex: "(?i)remote\\s+access\\s+trojan"
    fields:
      - raw
      - message
      - normalized.process_name
  
  # Keyloggers
  - id: SIG-MAL-017
    name: Keylogger Activity
    severity: high
    category: malware
    description: Detects keylogger indicators
    patterns:
      - regex: "(?i)keylog(ger)?"
      - regex: "(?i)getkeystate|getasynckeystate"
    fields:
      - raw
      - message
      - normalized.process_name
  
  # C2 Communication
  - id: SIG-MAL-018
    name: C2 Communication - HTTP
    severity: high
    category: command_and_control
    description: Detects HTTP-based C2 communication
    patterns:
      - regex: "(?i)user-agent:\\s*(curl|wget|python)"
      - regex: "(?i)/c2/|/command/|/beacon/"
    fields:
      - raw
      - message
      - normalized.http_path
  
  - id: SIG-MAL-019
    name: C2 Communication - DNS
    severity: high
    category: command_and_control
    description: Detects DNS-based C2 communication
    patterns:
      - regex: "(?i)dns\\s+c2"
      - regex: "[a-z0-9]{32,}\\.(com|net|org)"  # Long random subdomain
    fields:
      - raw
      - message
      - normalized.dns_query
  
  # Living Off the Land Binaries (LOLBins)
  - id: SIG-MAL-020
    name: LOLBin Abuse - Certutil
    severity: high
    category: defense_evasion
    description: Detects certutil abuse for file download
    patterns:
      - regex: "(?i)certutil.*-urlcache"
      - regex: "(?i)certutil.*-decode"
    fields:
      - raw
      - message
      - normalized.command
  
  - id: SIG-MAL-021
    name: LOLBin Abuse - BITSAdmin
    severity: high
    category: defense_evasion
    description: Detects bitsadmin abuse for file download
    patterns:
      - regex: "(?i)bitsadmin.*transfer"
      - regex: "(?i)bitsadmin.*/download"
    fields:
      - raw
      - message
      - normalized.command
